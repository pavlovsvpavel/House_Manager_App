{% extends "base.html" %}
{% load i18n %}

{% block main_content %}
    <section class="site-section reports">
        <div class="container">
            <div class="reports-wrapper">
                <form class="search_by_month_and_year" method="get">
                    <label for="year">
                        <select name="year" placeholder="Year" id="year">
                            <option value="" selected disabled>{% trans "Year" %}</option>
                            {% for choice in YearChoices %}
                                <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                            {% endfor %}
                        </select>
                    </label>
                    <label for="month">
                        <select name="month" id="month">
                            <option value="" selected disabled>{% trans "Month" %}</option>
                            {% for choice in MonthChoices.choices %}
                                <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                            {% endfor %}
                        </select>
                    </label>
                    <button class="search-btn" type="submit">{% trans "Search" %}</button>
                </form>
                <button class="save-btn" onclick="saveAsPDF()">{% trans "Save as PDF" %}</button>

                <div class="report-results">
                    <div class="details-for-house">
                        <p>{% trans "Town" %}: {{ current_house.town }}</p>
                        <p>{% trans "Address" %}: {{ current_house.address }}</p>
                        <p>{% trans "Building number" %}: {{ current_house.building_number }}</p>
                        <p>{% trans "Entrance" %}: {{ current_house.entrance }}</p>
                    </div>
                    <div class="details-for-house-bill">
                        {% for bill in bills %}
                            <p>{% trans "Year" %}: {{ bill.year }}</p>
                            <p>{% trans "Month" %}: {{ bill.get_month_name }}</p>
                            <p>{% trans "Total BGN" %}: {{ bill.total_amount }}</p>
                        {% endfor %}
                    </div>
                    <table>
                        <tr>
                            <th>{% trans "Family Name" %}</th>
                            <th>{% trans "Apartment" %}</th>
                            <th>{% trans "Total BGN" %}</th>
                            <th>{% trans "Signature" %}</th>
                        </tr>
                        {% for client_bill in clients_bills %}
                            <tr>
                                <td>{{ client_bill.client.family_name }}</td>
                                <td>{{ client_bill.client.apartment }}</td>
                                <td>{{ client_bill.total_amount }}</td>
                                <td></td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.0/html2pdf.bundle.min.js"></script>
    <script>
        function saveAsPDF() {
            // Get the content of the div element with class "report-results"
            const reportResultsElement = document.querySelector('.report-results');

            // Check if the element exists
            if (reportResultsElement) {
                // Create a new html2pdf instance
                const element = reportResultsElement;
                const opt = {
                    margin: 1,
                    filename: 'report_results.pdf',
                    image: {type: 'jpeg', quality: 0.98},
                    html2canvas: {scale: 2},
                    jsPDF: {unit: 'cm', format: 'letter', orientation: 'portrait'}
                };

                // Generate PDF from HTML element
                html2pdf().set(opt).from(element).save();
            } else {
                console.error('Element with class "report-results" not found.');
            }
        }
    </script>

{% endblock %}